var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),GameLayer=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(egret.Sprite);__reflect(GameLayer.prototype,"GameLayer");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var MapItem=function(t){function e(e){var i=t.call(this)||this;return i.bitmap=new egret.Bitmap,i.bitmap.x=5,i.bitmap.y=5,i.addChild(i.bitmap),i.type=e,0==e?i.bitmap.texture=RES.getRes("MapItemBg_png"):9==e?i.bitmap.texture=RES.getRes("end_png"):i.bitmap.texture=null,i.bitmap.width=10,i.bitmap.height=10,i}return __extends(e,t),e.prototype.removeRoute=function(){this.bitmap.x=5,this.bitmap.y=5,this.bitmap.width=10,this.bitmap.height=10,0==this.type?this.bitmap.texture=RES.getRes("MapItemBg_png"):9==this.type?this.bitmap.texture=RES.getRes("end_png"):this.bitmap.texture=null},e.prototype.setRoute=function(){this.bitmap.texture=RES.getRes("route_png"),this.bitmap.x=6,this.bitmap.y=6,this.bitmap.width=8,this.bitmap.height=8},e.prototype.setRouteing=function(){this.bitmap.texture=RES.getRes("red_png")},e}(egret.Sprite);__reflect(MapItem.prototype,"MapItem");var MapNode=function(){function t(){}return t}();__reflect(MapNode.prototype,"MapNode");var MapRoute=function(){function t(){}return t}();__reflect(MapRoute.prototype,"MapRoute");var Player=function(t){function e(){var e=t.call(this)||this;return e.bitmap=new egret.Bitmap,e.addChild(e.bitmap),e.bitmap.texture=RES.getRes("player_png"),e.bitmap.width=10,e.bitmap.height=10,e}return __extends(e,t),e}(egret.Sprite);__reflect(Player.prototype,"Player");var TabItem=function(t){function e(){var e=t.call(this)||this;return e.bitmap=new egret.Bitmap,e.addChild(e.bitmap),e.bitmap.texture=RES.getRes("player_png"),e.bitmap.width=15,e.bitmap.height=15,e}return __extends(e,t),e.prototype.choose=function(t){t?this.bitmap.texture=RES.getRes("end_png"):this.bitmap.texture=RES.getRes("player_png")},e}(egret.Sprite);__reflect(TabItem.prototype,"TabItem");var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e.fangxiang=0,e.curX=1,e.curY=1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},e.prototype.createScene=function(){this.startCreateScene()},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.onSocketOpen=function(){console.log("连接成功")},e.prototype.onReceiveMessage=function(t){var i=e.webSocket.readUTF();this.onmessage(i)},e.prototype.startCreateScene=function(){EngineMain.instance.init(this)},e.prototype.initchooseRoomPanel=function(){this.chooseRoomPanel=new egret.Sprite;var t=new egret.TextField;t.text="在下面输入房间号",this.chooseRoomPanel.addChild(t),t.width=500,t.size=24,t.textColor=16777215,t.x=0,t.y=30,t=new egret.TextField,t.text="",this.chooseRoomPanel.addChild(t),t.type=egret.TextFieldType.INPUT,t.width=500,t.size=24,t.textColor=0,t.background=!0,t.x=0,t.y=80,this.textfield=t;var e=new eui.Button;e.label="创建房间",e.x=200,e.y=150,this.chooseRoomPanel.addChild(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this),e=new eui.Button,e.label="加入房间",e.x=400,e.y=150,this.chooseRoomPanel.addChild(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick1,this),this.addChild(this.chooseRoomPanel)},e.prototype.onButtonClick=function(t){this.startgame()},e.prototype.onButtonClick1=function(t){var i=this.textfield.text;e.webSocket.writeUTF("jionroom,"+i)},e.prototype.startgame=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.addEventListener(egret.Event.ENTER_FRAME,this.timeHandle,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchbegin,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchmove,this)},e.prototype.touchbegin=function(t){this.clickx=t.$stageX,this.clicky=t.$stageY,this.moveCd=0},e.prototype.touchmove=function(t){Math.abs(t.$stageX-this.clickx)>Math.abs(t.$stageY-this.clicky)?t.$stageX>this.clickx?this.fangxiang=4:this.fangxiang=3:t.$stageY>this.clicky?this.fangxiang=2:this.fangxiang=1,this.clickx=t.$stageX,this.clicky=t.$stageY},e.prototype.touchEnd=function(t){this.fangxiang=0},e.prototype.startFarme=function(){},e.prototype.timeHandle=function(t){this.moveCd<0&&(1==this.fangxiang?this.view.getTargetCanGo(this.curX,this.curY-1)&&e.webSocket.writeUTF("week,"+this.roomId+","+this.curX+","+(this.curY-1)):2==this.fangxiang?this.view.getTargetCanGo(this.curX,this.curY+1)&&e.webSocket.writeUTF("week,"+this.roomId+","+this.curX+","+(this.curY+1)):3==this.fangxiang?this.view.getTargetCanGo(this.curX-1,this.curY)&&e.webSocket.writeUTF("week,"+this.roomId+","+(this.curX-1)+","+this.curY):4==this.fangxiang&&this.view.getTargetCanGo(this.curX+1,this.curY)&&e.webSocket.writeUTF("week,"+this.roomId+","+(this.curX+1)+","+this.curY),this.moveCd=3),this.moveCd--},e.prototype.onup=function(t){this.fangxiang=1,this.moveCd=0},e.prototype.ondown=function(t){this.fangxiang=2,this.moveCd=0},e.prototype.onleft=function(t){this.fangxiang=3,this.moveCd=0},e.prototype.onright=function(t){this.fangxiang=4,this.moveCd=0},e.prototype.tishi=function(t){null==this.tishitxt&&(this.tishitxt=new eui.Label,this.addChild(this.tishitxt)),this.tishitxt.y=500,this.tishitxt.width=640,this.tishitxt.text=t,this.tishitxt.textAlign="centre";var e=egret.Tween.get(this.tishitxt);e.to({y:-200},600)},e.prototype.onmessage=function(t){var e=t.split(",");switch(e[0]){case"mapdata":console.log(t),this.startgame(),this.roomId=e[1],this.view.initmap(e[2],e[4]),this.view;var i=new TestMan;i.x=10*this.curX,i.y=10*this.curY,this.addChild(i),this.manList.push(i),this.playerIndex=0;break;case"weekto":parseInt(e[1])==this.playerIndex&&(this.curX=parseInt(e[2]),this.curY=parseInt(e[3])),this.manList[parseInt(e[1])].x=10*parseInt(e[2]),this.manList[parseInt(e[1])].y=10*parseInt(e[3]);break;case"selfjoinroomsuccess":this.startgame(),this.roomId=e[1],this.view.initmap(e[2],e[5]),this.playerIndex=parseInt(e[3]);for(var s=0;s<=this.playerIndex;s++){var i=new TestMan;i.x=10,i.y=10,this.addChild(i),this.manList.push(i)}break;case"otherjoinroomsuccess":var i=new TestMan;i.x=10,i.y=10,this.addChild(i),this.manList.push(i);break;default:this.tishi(t)}},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.removeTargetStage=function(t){t&&t.parent&&t.parent.removeChild(t)},e.prototype.startAnimation=function(t){var e=this,i=new egret.HtmlTextParser,s=t.map(function(t){return i.parse(t)}),n=this.textfield,o=-1,r=function(){o++,o>=s.length&&(o=0);var t=s[o];n.textFlow=t;var i=egret.Tween.get(n);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(r,e)};r()},e}(eui.Scroller);__reflect(Main.prototype,"Main");var MapManager=function(){function t(){this.curStep=0,this._width=63,this._height=33,this.thewayweeknum=0,this.maxweeknum=0,this.endPoint=""}return t.prototype.initNodes=function(t){this.nodeList=[];for(var e,i=0;i<t.length;i++){null==this.nodeList[i]&&(this.nodeList[i]=new Array(t[i].length));for(var s=0;s<t[i].length;s++)e=new MapNode,e.type=t[i][s],e.x=i,e.y=s,this.nodeList[i][s]=e}this.sortWay()},t.prototype.displayWay=function(t,e){return this.waylist[this.getWayKey(this.nodeList[t][e])]?this.waylist[this.getWayKey(this.nodeList[t][e])]:[this.waysById[this.nodeList[t][e].wayId]]},t.prototype.sortWay=function(){this.waylist={},this.waysById={},this.wayIndex=0,this.findedNodes={},this.findway(1,1,this.creatWay(this.nodeList[1][1]),-1,-1),this.findedNodes=null},t.prototype.creatWay=function(t){var e=new Way;return e.startPoint=t,e.list=[t],e.wayId=this.wayIndex,this.wayIndex++,e},t.prototype.finishWay=function(t,e){e.endPoint=t,this.putWay(e)},t.prototype.putWay=function(t){var e=this.waylist[this.getWayKey(t.startPoint)];null==e&&(e=this.waylist[this.getWayKey(t.startPoint)]=[]),e.push(t);var e=this.waylist[this.getWayKey(t.endPoint)];null==e&&(e=this.waylist[this.getWayKey(t.endPoint)]=[]),e.push(t),this.waysById[t.wayId]=t},t.prototype.isExistTheWay=function(t,e){var i=this.waylist[this.getWayKey(t)];if(i)for(var s=0;s<i.length;s++)if(i[s].endPoint==t){if(i[s].list.length>1&&i[s].list[i[s].list.length-1]==e)return!0}else if(i[s].list.length>1&&i[s].list[1]==e)return!0;return!1},t.prototype.getWayKey=function(t){return t.x+","+t.y},t.prototype.findway=function(t,e,i,s,n){if(!this.findedNodes[t+","+e]){var o,r=[];if(t>0&&(t-1!=s||e!=n)&&(o=this.nodeList[t-1][e],0!=o.type&&r.push(o)),t<this.nodeList.length&&(t+1!=s||e!=n)&&(o=this.nodeList[t+1][e],0!=o.type&&r.push(o)),e>0&&(t!=s||e-1!=n)&&(o=this.nodeList[t][e-1],0!=o.type&&r.push(o)),e<this.nodeList[t].length&&(t!=s||e+1!=n)&&(o=this.nodeList[t][e+1],0!=o.type&&r.push(o)),this.nodeList[t][e].wayId=i.wayId,i.list.push(this.nodeList[t][e]),this.findedNodes[t+","+e]=this.nodeList[t][e],1==r.length)this.findway(r[0].x,r[0].y,i,t,e);else if(r.length>1){-1!=s&&-1!=n&&this.finishWay(this.nodeList[t][e],i);for(var a=0;a<r.length;a++)this.isExistTheWay(this.nodeList[t][e],r[a])||this.findway(r[a].x,r[a].y,this.creatWay(this.nodeList[t][e]),t,e)}else this.finishWay(this.nodeList[t][e],i)}},t.prototype.findThcWay=function(t,e,i,s){var n=(new Date).getTime();this.waylist[this.getWayKey(this.nodeList[i][s])]?this.targetWay=this.waylist[this.getWayKey(this.nodeList[i][s])]:this.targetWay=[this.waysById[this.nodeList[i][s].wayId]],this.canTranslateWays=[],this.findedWays={};var o;o=this.waylist[this.getWayKey(this.nodeList[t][e])]?this.waylist[this.getWayKey(this.nodeList[t][e])]:[this.waysById[this.nodeList[t][e].wayId]];for(var r=0;r<o.length;r++)this.findNextWay(o[r],[],o[r].startPoint),this.findNextWay(o[r],[],o[r].endPoint);EngineMain.instance.disWayRoute(this.canTranslateWays),console.log("规划消耗时间"+((new Date).getTime()-n)),console.log(this.canTranslateWays)},t.prototype.findNextWay=function(t,e,i){if(!this.findedWays[t.wayId]){var s,n=[];if(i==t.endPoint&&this.waylist[this.getWayKey(t.startPoint)]&&(n=n.concat(this.waylist[this.getWayKey(t.startPoint)]),s=t.startPoint),i==t.startPoint&&this.waylist[this.getWayKey(t.endPoint)]&&(n=n.concat(this.waylist[this.getWayKey(t.endPoint)]),s=t.endPoint),e.push(t),this.findedWays[t.wayId]=t,this.isStayTarget(t))return void this.canTranslateWays.push(e);if(n)for(var o=0;o<n.length;o++)this.findNextWay(n[o],e.concat(),s)}},t.prototype.isStayTarget=function(t){for(var e=0;e<this.targetWay.length;e++)if(this.targetWay[e]==t)return!0;return!1},t.prototype.Astar=function(t,e,i,s){var n=(new Date).getTime();this.curStep=0,this.routeArr=[],this.nextList=[],clearInterval(this.timeindex),this.findTaget(t,e,i,s,[],-1,-1),2==EngineMain.instance.gametype?this.timeindex=setInterval(this.nextround.bind(this),20):console.log("Astar消耗时间"+((new Date).getTime()-n))},t.prototype.displayRound=function(){EngineMain.instance.disRoute(this.routeArr[0])},t.prototype.findTaget=function(t,e,i,s,n,o,r){EngineMain.instance.disroutepoint(new egret.Point(t,e));var a,h;n.push(new egret.Point(t,e)),t>0&&(a=t-1,h=e,this.weekto(t,e,i,s,a,h,n.concat(),o,r)),t<this.nodeList.length&&(a=t+1,h=e,this.weekto(t,e,i,s,a,h,n.concat(),o,r)),e>0&&(h=e-1,a=t,this.weekto(t,e,i,s,a,h,n.concat(),o,r)),e<this.nodeList[t].length&&(h=e+1,a=t,this.weekto(t,e,i,s,a,h,n.concat(),o,r)),1==EngineMain.instance.gametype&&this.nextround()},t.prototype.nextround=function(){if(null==this.nextList)return clearInterval(this.timeindex),void this.displayRound();this.cannext();for(var t=0;t<this.nextList.length;t++){var e=this.nextList[t];if(this.curStep+1==e.arr.length&&(this.nextList.splice(t,1),this.findTaget(e.nextx,e.nexty,e.targetx,e.targety,e.arr,e.curx,e.cury),t--,null==this.nextList))return}},t.prototype.cannext=function(){for(var t=0;t<this.nextList.length;t++){var e=this.nextList[t];if(this.curStep+1==e.arr.length)return}this.curStep++},t.prototype.weekto=function(t,e,i,s,n,o,r,a,h){if((a!=n||h!=o)&&null!=this.nextList&&0!=this.nodeList[n][o].type&&this.isweek(n,o,r))if(n==i&&o==s)console.log("完成"+r.length),this.routeArr.push(r),this.nextList=null;else{var p=new NextObject;p.nextx=n,p.nexty=o,p.targetx=i,p.targety=s,p.arr=r,p.curx=t,p.cury=e,this.nextList.push(p)}},t.prototype.isweek=function(t,e,i){for(var s=0;s<i.length;s++)if(i[s].x==t&&i[s].y==e)return!1;return!0},t.prototype.getMapData=function(){var t="";this.creatBaseMap(this._width,this._height);for(var e=0;e<2*this._width+1;e++){for(var i=0;i<2*this._height+1;i++)t+=this.maplist[e][i]+";";t+="。"}return t},t.prototype.creatBaseMap=function(t,e){this.maplist=new Array(2*t+1),this.disposeList=new Array(2*t+1),this.weekList=new Array,this.weekNumList=new Array;for(var i=0;2*t+1>i;i++){null==this.maplist[i]&&(this.maplist[i]=new Array(2*e+1));for(var s=0;2*e+1>s;s++)i%2==1&&s%2==1?this.maplist[i][s]=1:this.maplist[i][s]=0}this.randomDirection(1,1)},t.prototype.gettargetpoint=function(){var t=Math.random();if(.25>t){var e=Math.floor(Math.random()*(2*this._height+1));this.maplist[0][e]=1}else if(.5>t){var e=Math.floor(Math.random()*(2*this._height+1));this.maplist[2*this._width][e]=1}else if(.75>t){var e=Math.floor(Math.random()*(2*this._width+1));this.maplist[e][0]=1}else{var e=Math.floor(Math.random()*(2*this._width+1));this.maplist[e][2*this._height]=1}},t.prototype.randomDirection=function(t,e){var i=this.maybeGoList(t,e);if(i.length>0){this.thewayweeknum++;var s=Math.floor(Math.random()*i.length),n=i[s],o=(n[0]-t)/2+t,r=(n[1]-e)/2+e;this.maplist[o][r]=1,null==this.disposeList[n[0]]&&(this.disposeList[n[0]]=new Array(2*this._height+1)),this.disposeList[n[0]][n[1]]=1,i.length>1&&(this.weekList.push(n),this.weekNumList.push(this.thewayweeknum)),this.randomDirection(n[0],n[1])}else{this.thewayweeknum>this.maxweeknum&&(this.maxweeknum=this.thewayweeknum,this.endPoint=t+";"+e);for(var a=this.weekList.length-1;a>=0;a--)if(this.maybeGoList(this.weekList[a][0],this.weekList[a][1]).length>0){var h=this.weekList[a][0],p=this.weekList[a][1];return this.thewayweeknum=this.weekNumList[a],1==this.maybeGoList(this.weekList[a][0],this.weekList[a][1]).length&&(this.weekList.splice(a,1),this.weekNumList.splice(a,1)),void this.randomDirection(h,p)}}},t.prototype.maybeGoList=function(t,e){var i=new Array;return t-2>0&&(this.disposeList[t-2]&&this.disposeList[t-2][e]||i.push(new Array(t-2,e))),t+2<2*this._width+1&&(this.disposeList[t+2]&&this.disposeList[t+2][e]||i.push(new Array(t+2,e))),e-2>0&&(this.disposeList[t]&&this.disposeList[t][e-2]||i.push(new Array(t,e-2))),e+2<2*this._height+1&&(this.disposeList[t]&&this.disposeList[t][e+2]||i.push(new Array(t,e+2))),i},Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t}();__reflect(MapManager.prototype,"MapManager");var Way=function(){function t(){}return t}();__reflect(Way.prototype,"Way");var NextObject=function(){function t(){}return t}();__reflect(NextObject.prototype,"NextObject");var SocketConnector=function(){function t(t,e){this.initSocket(t,e)}return t.prototype.initSocket=function(t,e){EngineMain.instance.initmap(MapManager.instance.getMapData(),MapManager.instance.endPoint)},t.prototype.onReceiveMessage=function(t){console.log("收到数据");var e=Main.webSocket.readUTF();this.onmessage(e)},t.prototype.onSocketConnect=function(t){console.log("连接成功"),EngineMain.instance.initmap(MapManager.instance.getMapData(),MapManager.instance.endPoint)},t.prototype.onmessage=function(t){var e=t.split(",");switch(console.log(e[0]),e[0]){case"mapdata":}},t}();__reflect(SocketConnector.prototype,"SocketConnector");var ControlButton=function(t){function e(){var e=t.call(this)||this;return e.graphics.beginFill(16777215,.8),e.graphics.drawCircle(-75,-75,75),e.graphics.endFill(),e}return __extends(e,t),e}(egret.Sprite);__reflect(ControlButton.prototype,"ControlButton");var EngineMain=function(){function t(){this.desStr=["AStar","AStar过程","点击查看道路","规划寻路"]}return t.prototype.init=function(t){this._stage=t,this.player=new Player,this.player.x=15,this.player.y=15,this._stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.socketConnector=new SocketConnector("127.0.0.1",4788)},t.prototype.onClick=function(t){if(t.stageY<15)for(var e=0;5>e;e++)t.stageX>=30*e+20&&t.stageX<=30*e+20+15?(this.tabArr[e].choose(!0),this.gametype=e+1,console.log(this.desStr[e])):this.tabArr[e].choose(!1);else{var i=Math.floor((this.player.x-5)/10),s=Math.floor((this.player.y-5)/10),n=Math.floor((t.stageX-5)/10),o=Math.floor((t.stageY-5)/10);if(this.resetRoute(),this.tragetx=n,this.tragety=o,this.gametype<3)MapManager.instance.Astar(i,s,n,o);else if(4==this.gametype)MapManager.instance.findThcWay(i,s,n,o);else if(3==this.gametype)for(var r=MapManager.instance.displayWay(n,o),e=0;e<r.length;e++)for(var a=0;a<r[e].list.length;a++)this.mapItemlist[r[e].list[a].x][r[e].list[a].y].setRoute()}},t.prototype.disWayRoute=function(t){for(var e=0;e<t.length;e++)for(var i=0;i<t[e].length;i++)for(var s=0;s<t[e][i].list.length;s++)this.mapItemlist[t[e][i].list[s].x][t[e][i].list[s].y].setRoute()},t.prototype.getTargetCanGo=function(t,e){return 1==this.maplist[t][e]?!0:!1},t.prototype.initmap=function(t,e){var i=t.split("。");this.maplist=new Array(i.length-1);for(var s=this.maplist,n=0;n<i.length-1;n++){var o=i[n].split(";");null==s[n]&&(s[n]=new Array(o.length-1));for(var r=0;r<o.length-1;r++)s[n][r]=parseInt(o[r])}MapManager.instance.initNodes(s),this.mapItemlist=new Array;for(var a,n=0;n<s.length;n++){null==this.mapItemlist[n]&&(this.mapItemlist[n]=new Array);for(var r=0;r<s[n].length;r++)a=new MapItem(s[n][r]),a.x=10*n,a.y=10*r,this._stage.addChild(a),this.mapItemlist[n][r]=a}this._stage.addChild(this.player),this.tabArr=[];for(var n=0;5>n;n++){var h=new TabItem;h.x=30*n+20,this._stage.addChild(h),this.tabArr.push(h)}this.tabArr[0].choose(!0),this.gametype=1},t.prototype.resetRoute=function(){for(var t=0;t<this.mapItemlist.length;t++)for(var e=0;e<this.mapItemlist[t].length;e++)this.mapItemlist[t][e].removeRoute()},t.prototype.disRoute=function(t){this.routeArr=t,this.resetRoute();for(var e=0;e<t.length;e++)this.mapItemlist[t[e].x][t[e].y].setRoute()},t.prototype.nextround=function(){this.player.x=5+10*this.routeArr[0].x,this.player.y=5+10*this.routeArr[0].y,this.routeArr.shift(),0==this.routeArr.length&&clearInterval(this.timeindex)},t.prototype.disroutepoint=function(t){this.mapItemlist[t.x][t.y].setRouteing()},Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t}();__reflect(EngineMain.prototype,"EngineMain");var TestMan=function(t){function e(){var e=t.call(this)||this;return e.graphics.beginFill(16711680,.8),e.graphics.drawCircle(5,5,5),e.graphics.endFill(),e}return __extends(e,t),e}(egret.Sprite);__reflect(TestMan.prototype,"TestMan");